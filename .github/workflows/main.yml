name: A workflow for my Hello World file
on: 
  - push
  - workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: registry.gitlab.com/islandoftex/images/texlive:latest

    steps:
    - uses: actions/checkout@v2

    - name: Analyse manual log and create annotation(s)
      run: |
        # setting a warning message:
        #  https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-a-warning-message
        # trick to create multiline annotation:
        #  use url-encoded newline %0A
        #  https://github.com/actions/toolkit/issues/193#issuecomment-605394935
        OVERFULL_HBOX=$( \
          grep -r '^Overfull \\hbox' tex/pgfmanual.log |     \
          awk 'BEGIN {RS=""}{gsub(/\n/,"%0A",$0); print $0}' \
        )
        echo "::warning file=tex/pgfmanual.log,title=Overfull hbox(es)::$OVERFULL_HBOX"
